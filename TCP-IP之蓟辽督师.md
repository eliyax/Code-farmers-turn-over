## TCP/IP之蓟辽督师

原创： 刘欣  码农翻身

本文续《TCP/IP之大明内阁》， 不了解背景的同学可以先看看上一篇文章， 当然这篇也是《TCP/IP之大明邮差》的前传， 主要讲一讲可靠性传输的原理。

袁崇焕奉圣旨进京，也被迫带来了他的心肝宝贝幻月宝镜。

他一进京，顾上休息， 立刻就先去拜见曾经举荐提报自己的恩师孙承宗， 看到自己的爱将风尘仆仆的赶来，虽然心疼， 稍事寒暄过后，还是立刻问起了怎么用幻月宝镜实现可靠传输的问题。

袁崇焕道： “老师有所不知， 这幻月宝镜虽好，但是如果没有失败重传的方法，一切都是白搭。 关外的环境比关内更加恶劣， 除了强盗野兽，还有飘忽不定的清军骑兵，随时打劫你。 ”

“确实是实情， 老夫当年巡视辽东的时候也看到了， 那你发出去物资以后， 是不是要等待对方的回复确认啊？”

“老师说的对，这也是我们刚开始的设想， 请看这张状态图：”

![1](http://mmbiz.qpic.cn/mmbiz_png/KyXfCrME6UJ9QbNuclyXXtLmQnOzRoZoOwhKtFZUovTpMkjcK4dkPoFxFWibnHWDs05Er5ko27TBRkgZ96e0T7g/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

“状态图是什么东西？ 你自己弄的？”


“不， 这是荷兰红毛送红衣大炮的时候教我画的， 他们那边的人很擅长搞这种玩意， 说是‘科学’， 这张图的第一个状态是‘等待发送数据’， 然后发送分组数据进入了第二个状态‘等待反馈’， 此时如果对方发来了反馈说‘收到了’， 那就回到第一个状态， 否则， 重发之前的数据”

“荷兰红毛还是挺厉害的， 这是个描述系统的好方法啊，比纯用我们汉字好多了。 ”

“是的老师， 这个状态图的问题就是：如果对方发回的反馈损坏了改怎么办？”

孙承宗道：“有道理， 如果反馈损坏了， 发送方将无法理解接收方是否收到数据分组， 只好重新发送上一个分组， 但是从接收方来看， 没法区分这个分组是新的还是一次重传， 这就麻烦了。 ”

“所以我和满桂、祖大寿他们商量了下， 我们采用给数据编号的办法来解决这个问题， 第一次发送编号为A的， 然后就等待针对A的反馈， 如果反馈没法识别或者是没收到， 那就重新发送， 如果反馈是‘收到了’， 那就发送分组编号为B的数据。 ”


